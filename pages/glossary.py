# pages/glossary.py
import streamlit as st
import pandas as pd

st.set_page_config(page_title="系統說明書", layout="wide")

st.title("📘 評分邏輯與名詞解釋說明書")
st.markdown("本頁面詳細解釋「台股量化交易系統研究報告」中採用的估值模型、指標定義與操作策略。")

# --- 第一部分：估值評分卡 ---
st.header("1. 核心估值模型 (Valuation Scorecard)")
st.markdown("""
本系統依據 **研究報告表 2** 之邏輯，將質化分析轉化為量化分數。
總分越高，代表買進訊號越強烈。
""")

# 建立評分邏輯表
score_data = {
    "指標類別": [
        "基本面體質 (F-Score)", "基本面體質 (F-Score)", "基本面體質 (F-Score)",
        "破產風險 (Z-Score)", "破產風險 (Z-Score)",
        "相對估值 (PE Ratio)", "相對估值 (PE Ratio)",
        "資產價值 (PB Ratio)",
        "成長動能 (Revenue)", "成長動能 (Revenue)"
    ],
    "條件判斷": [
        "F-Score ≥ 8 分", "F-Score 5 ~ 7 分", "F-Score ≤ 3 分",
        "Z-Score > 2.99", "Z-Score < 1.81",
        "本益比 < 12", "本益比 > 25",
        "股價淨值比 < 1.0",
        "營收年增率 (YoY) > 20%", "營收月增率 (MoM) > 10%"
    ],
    "分數調整": [
        "+2", "+1", "-2",
        "+1", "-3 (扣分)",
        "+1", "-1 (扣分)",
        "+1",
        "+1", "+1"
    ],
    "策略意涵": [
        "體質極佳，首選標的", "體質穩健", "體質衰退，應避開",
        "財務安全區域 (Safe Zone)", "財務困境區域 (Distress Zone)",
        "價格被低估 (歷史中位數以下)", "價格過熱",
        "股價低於清算價值 (Deep Value)",
        "長期成長動能強勁", "短期營運加速升溫"
    ]
}

df_score = pd.DataFrame(score_data)
st.table(df_score)

st.info("""
**決策燈號定義：**
* 🟢 **強力買進 (Strong Buy):** 總分 ≥ 5 分
* 🔵 **買進/持有 (Buy/Hold):** 總分 3 ~ 4 分
* 🟠 **觀望 (Watch):** 總分 0 ~ 2 分
* 🔴 **賣出/避開 (Sell/Avoid):** 總分 < 0 分
""")

st.divider()

# --- 第二部分：名詞解釋 ---
st.header("2. 關鍵指標詳解")

with st.expander("📊 Piotroski F-Score (皮爾托斯基分數)"):
    st.markdown("""
    **定義：** 一個 0 到 9 分的評分系統，用於評估公司財務狀況是否正在改善。
    
    **本系統採用的 9 大檢測項目：**
    1. **獲利性：** ROA > 0
    2. **獲利性：** 營運現金流 (CFO) > 0
    3. **獲利性：** CFO > 稅後淨利 (代表盈餘品質佳，非帳面富貴)
    4. **獲利性：** ROA 優於去年 (YoY > 0)
    5. **槓桿：** 長期負債比率下降
    6. **流動性：** 流動比率 (Current Ratio) 上升
    7. **股權：** 無顯著現金增資 (避免股權稀釋)
    8. **效率：** 毛利率 (Gross Margin) 提升
    9. **效率：** 資產週轉率 (Asset Turnover) 提升
    """)

with st.expander("💀 Altman Z-Score (破產風險預警)"):
    st.markdown("""
    **定義：** 利用五個財務比率加權計算，預測公司在未來兩年內破產的機率。
    
    **公式：** $Z = 1.2X_1 + 1.4X_2 + 3.3X_3 + 0.6X_4 + 1.0X_5$
    * $X_1$: 營運資金 / 總資產
    * $X_2$: 保留盈餘 / 總資產 (反映公司累積獲利能力)
    * $X_3$: EBIT / 總資產 (最關鍵的本業獲利指標)
    * $X_4$: 權益市值 / 總負債
    * $X_5$: 總營收 / 總資產 (週轉率)
    
    **判讀標準：**
    * **> 2.99：** 安全區 (Safe Zone)
    * **1.81 ~ 2.99：** 灰色區 (Grey Zone)
    * **< 1.81：** 危險區 (Distress Zone) - **系統會重扣 3 分**
    
    **⚠️ 注意：** 金融業 (銀行、保險、金控) 因負債結構特殊，不適用此模型，系統會顯示 N/A。
    """)

with st.expander("📈 營收動能 (YoY & MoM)"):
    st.markdown("""
    **定義：** 台股法規規定每月 10 日前需公佈營收，這是全球少見的高頻基本面數據。
    
    * **MoM (Month-on-Month):** 月增率。反映短期（近一個月）的營運熱度。
    * **YoY (Year-on-Year):** 年增率。反映長期（跟去年同期比）的成長趨勢，能排除季節性因素。
    
    **策略價值：** 營收通常是獲利的領先指標。營收先衝出來，季報獲利通常會跟上。
    """)

st.divider()

# --- 第三部分：操作策略 ---
st.header("3. 延遲對策與下單教學")
st.warning("⚠️ 本系統使用免費數據源，盤中報價可能存在 20 分鐘延遲。")

st.markdown("""
為了規避資訊延遲造成的「滑價風險 (Slippage)」，本研究報告建議採用以下下單策略：

#### 1. 盤後佈局 (EOD Strategy) - **推薦**
* **操作時間：** 每日收盤後 (13:30 以後) 或次日開盤前 (08:30 以前)。
* **方法：** 使用本系統分析完畢後，若決定買進，直接掛入**次日開盤的限價單**。
* **優點：** 完全不受盤中延遲數據干擾，決策最從容。

#### 2. 尾盤集合競價 (Pre-Close Strategy)
* **操作時間：** 13:25 ~ 13:30。
* **方法：** 若盤中訊號明確，可於最後 5 分鐘掛入 **ROD (Rest of Day)** 限價單。
* **技巧：** 價格可設定在「目前成交價 + 1%」，確保在最後一盤撮合成功，但又不至於買在漲停板等極端價格。

#### ❌ 絕對禁止的操作
* **嚴禁使用「市價單 (Market Order)」：** 因為你看到的價格是 20 分鐘前的，現在的價格可能已經飛天或鑽地，市價單會讓你買在未知的價格，風險極大。
""")
